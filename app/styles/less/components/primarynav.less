nav#nav-main
{
    // Default

    position: relative;
        top: 0;
        left: 0;
        z-index: 99;
    width: 100%;

    &.scrollable
    {
        .nav-items
        {
            // overflow-y: auto;
            // position: fixed;
            //     top: 0;
            //     right: 0;
            //     bottom: 100%;
            //     left: 0;
        }

    }

    // Usually the state after scrolling from the top of the page.
    &.compact
    {
        .icon-height(@factor_compact_header);

        position: fixed;
            top: 0;

        .nav-icon-wrapper
        {
            position: relative;
                top: 0;
                left: 0;
                //z-index: 1;
        }
    }

    // When menu has "centered" behavior.
    &.centered
    {
        .nav-icon-wrapper
        {
            a#nav-icon
            {
                float: none;
                margin: 0 auto;
                // opacity: 0;
            }
        }

        .nav-items
        {
            ul.nav-primary,
            ul.nav-sub
            {
                li,
                li.gallery,
                li.list
                {
                    a
                    {
                        text-align: center;
                    }
                }
            }
        }
    }

    .nav-icon-wrapper
    {
        overflow: hidden;

        // Importantly, this icon's visibility determines if the menu is collapsible.
        a#nav-icon
        {
            //.transition(all 600ms ease-out);

            color: @black_50;

            svg
            {
                fill: transparent;
                width: 100%;
                stroke: currentColor;
            }

            &:hover
            {
                color: #000;
            }

            .respond-until-including(@1_column_width,
            {
                width: 2.000em; // 32px
            });

            .respond-after(@1_column_width,
            {
                width: 2.125em; // 34px
            });
        }
    }

    .nav-items
    {
        ul.nav-primary
        {
            li.gallery,
            li.list
            {
                a
                {
                    .transition(all 300ms ease-out);

                    display: block;

                    svg
                    {
                        fill: transparent;
                        stroke: currentColor;
                    }

                    span.text-label
                    {
                        display: none;
                    }

                    &:hover
                    {
                        //color: #000;
                    }
                }

                &.active
                {
                    a
                    {
                        //color: #000;
                        cursor: default;
                    }
                }
            }
        }

        ul.nav-sub
        {
            li
            {
                a
                {
                    .transition(all 300ms ease-out);

                    //color: #808080;
                    display: block;
                    //font-family: @title_face;
                    //font-size: 1.125em;
                    //letter-spacing: 0.188em;
                    //text-decoration: none;
                    //text-transform: uppercase;

                    &:hover
                    {
                        //color: #000;
                    }
                }

                &.active
                {
                    a
                    {
                        //color: #000;
                        cursor: default;
                    }
                }
            }
        }
    }

    // Media Queries

    .respond-until-including(@multi_column_bp,
    {
        .collapsible-menu-c();
    });

    .respond-until-including(@1_column_width,
    {
        @factor: 0.5;

        .icon-height(@factor);
        .list-top-match-header(@factor);
        .list-bottom-header-padding(@factor);

        &.compact
        {
            .list-top-match-header(@factor_compact_header, @factor);
        }
    });

    .respond-between(@1_column_width, @multi_column_bp,
    {
        @factor: 0.75;

        .icon-height(@factor);
        .list-top-match-header(@factor);
        .list-bottom-header-padding(@factor);

        &.compact
        {
            .list-top-match-header(@factor_compact_header, @factor);
        }
    });

    .respond-after(@multi_column_bp,
    {
        @factor: 1;

        .horizontal-menu();
        .item-heights(@factor);
    });

    // Local Mixins

    .icon-height(@factor: 1)
    {
        .nav-icon-wrapper
        {
            a#nav-icon
            {
                height: @header_height * @factor;

                svg
                {
                    height: @header_height * @factor;
                }
            }
        }
    }

    .list-top-match-header(@factor_height: 1, @factor_padding: 0)
    {
        .nav-items .nav-items-wrapper
        {
            padding-top: (@header_height * @factor_height) + (@header_padding * @factor_padding);
        }
    }

    .list-bottom-match-header(@factor: 1)
    {
        .nav-items .nav-items-wrapper
        {
            padding-bottom: @header_height * @factor;
        }
    }

    .list-top-header-padding(@factor: 1)
    {
        .nav-items .nav-items-wrapper
        {
            padding-top: @header_padding * @factor;
        }
    }

    .list-bottom-header-padding(@factor: 1)
    {
        .nav-items .nav-items-wrapper
        {
            padding-bottom: @header_padding * @factor;
        }
    }

    // This is ideal for situations where the primary menu is not collapsible
    // (i.e., all menu items are visible).
    .item-heights(@factor: 1)
    {
        .nav-items
        {
            ul.nav-primary
            {
                li
                {
                    height: @header_height * @factor;
                }

                li.gallery,
                li.list
                {
                    a
                    {
                        svg
                        {
                            height: @header_height * @factor;
                        }

                        span.text-label
                        {
                            height: @header_height * @factor;
                            line-height: @header_height * @factor;
                        }
                    }
                }
            }

            ul.nav-sub
            {
                li
                {
                    height: @header_height * @factor;
                    line-height: @header_height * @factor;

                    a
                    {
                        height: @header_height * @factor;
                        line-height: @header_height * @factor;
                    }
                }
            }
        }
    }
}

.horizontal-menu()
{
    overflow: hidden;

    .nav-icon-wrapper
    {
        a#nav-icon
        {
            display: none;
        }
    }

    .nav-items
    {
        float: left;
        width: 100%;

        ul.nav-primary
        {
            float: left;

            li
            {
                float: left;
                margin-left: @spacing_unit_root / 2;
            }

            li:first-child
            {
                margin-left: 0;
            }

            li.gallery,
            li.list
            {
                a
                {
                    color: @black_50;
                    font-family: @title_face;
                    letter-spacing: 0.188em;
                    text-decoration: none;
                    text-transform: uppercase;

                    svg
                    {
                        float: left;
                        width: 2.000em; // 32px
                    }

                    span.text-label
                    {
                        display: none;
                    }

                    &:hover
                    {
                        color: #000;
                    }
                }

                &.active
                {
                    a
                    {
                        color: #000;
                        cursor: default;
                    }
                }
            }
        }

        ul.nav-sub
        {
            float: right;

            li
            {
                float: left;
                margin-right: @spacing_unit_root;
                width: auto;

                &:last-child
                {
                    margin-right: 0;
                }

                a
                {
                    color: @black_50;
                    font-family: @title_face;
                    font-size: 1.125em;
                    letter-spacing: 0.188em;
                    text-decoration: none;
                    text-transform: uppercase;

                    &:hover
                    {
                        color: #000;
                    }
                }

                &.active
                {
                    a
                    {
                        color: #000;
                        cursor: default;
                    }
                }
            }
        }
    }
}

.collapsible-menu-c()
{
    // position: absolute;
    //     top: 0;
    //     right: 0;
    //     left: 0;

    &.scrollable
    {
        // Without this, we get two scrollbars. Position being fixed is what
        // causes the hamburger icon to shift horizontally when the window
        // scrollbar is hidden. This makes sense, because the position is
        // relative to the window. Fixed in JavaScript by sniffing out scrollbar
        // width and adding padding to account for missing scrollbar.
        position: fixed;

        .nav-icon-wrapper
        {
            background: #fff;
        }

        .nav-items
        {
            overflow-y: auto;

            position: absolute;
                // top: 0;
                // bottom: 0;
                left: 0;
                right: 0;
        }
    }

    .nav-icon-wrapper
    {
        a#nav-icon
        {
            display: block;
            float: right;
            position: relative;
                top: 0;
                left: 0;
                z-index: 100;

            .respond-until-including(@entry_image_width,
            {
                margin-right: @spacing_unit_root / 2;
            });

            .respond-between(@entry_image_width, @entry_image_width + 100px,
            {
                margin-right: @spacing_unit_root;
            });

            .respond-after(@entry_image_width + 100px,
            {
                margin-right: 0;
            });
        }

        .respond-after(@entry_image_width + 100px,
        {
            margin: 0 auto;
            width: @entry_image_width;
        });
    }

    .nav-items
    {
        // position: fixed;
        //     top: 0;
        //     right: 0;
        //     bottom: 100%;
        //     left: 0;

        // .transition(bottom 400ms @ease_in_sine);

        // background: rgba(255, 255, 255, 0.95);
        // height: 100%;
        // overflow-y: auto;
        // padding: @spacing_unit_root 0;
        // position: fixed;
            // top: 0; // Animate from -100%
            // right: 0;
            // left: 0;
        // width: 50%;

        ul.nav-primary,
        ul.nav-sub
        {
            li,
            li.gallery,
            li.list
            {
                text-align: center;

                .respond-after(@entry_image_width + 100px,
                {
                    margin: 0 auto;
                    width: @entry_image_width;
                });

                a
                {
                    color: @black_50;
                    display: inline-block;
                    font-family: @title_face;
                    font-size: @spacing_unit_root * 0.65;
                    letter-spacing: 0.188em;
                    line-height: @spacing_unit_root;
                    position: relative;
                        top: 0;
                        left: 0;
                        z-index: 0;
                    text-decoration: none;
                    text-transform: uppercase;

                    &::after
                    {
                        border-bottom: 2px solid @black_85;
                        content: '';
                        display: block;
                        position: absolute;
                            bottom: 50%;
                            left: 0;
                            z-index: -1;
                        margin-top: 1px;
                        width: 0%;
                    }

                    &:hover
                    {
                        color: #000;
                    }

                    .respond-until-including(@entry_image_width,
                    {
                        padding: 0 @spacing_unit_root / 2;
                    });

                    .respond-between(@entry_image_width, @entry_image_width + 100px,
                    {
                        padding: 0 @spacing_unit_root;
                    });

                    .respond-between(@entry_image_width + 100px, @multi_column_bp
                    {
                        padding: 0 @spacing_unit_root / 2;
                    });
                }

                &.active
                {
                    a
                    {
                        // text-decoration: line-through;

                        &:hover
                        {
                            color: @black_50;
                        }

                        &::after
                        {
                            .transition(width 200ms @ease_in_sine);

                            width: 100%;
                        }
                    }
                }
            }
        }

        ul.nav-primary
        {
            position: relative;
                top: 0;
                left: 0;

            li
            {
                margin: 0;

                &:first-child
                {
                    margin: 0;
                }
            }

            li.gallery,
            li.list
            {
                a
                {
                    svg
                    {
                        display: none;
                    }

                    span.text-label
                    {
                        display: inline;
                    }

                    &:hover
                    {
                        svg
                        {
                            stroke: currentColor;
                        }
                    }
                }
            }
        }

        .respond-until-including(@multi_column_bp,
        {
            // .drop-shadow(0, 2px, 0, 0, 0, 0, 0, .07);

            background: #fff;
            // position: fixed;
                // top: 0;
            position: absolute;
                // top: -100%;
                right: 0;
                bottom: 100%; // Default for non-compacted state
                left: 0;
            // width: 100%;
        });

        .respond-until-including(@1_column_width,
        {
            // padding-bottom: @spacing_unit_root / 2;
        });

        .respond-after(@1_column_width,
        {
            // padding-bottom: @spacing_unit_root;
        });
    }

    &.compact
    {
        .nav-items
        {
            .drop-shadow(0, 2px, 0, 0, 0, 0, 0, .07);

            .respond-until-including(@1_column_width,
            {
                // padding-top: 0;
            });

            .respond-after(@1_column_width,
            {
                // padding-top: @spacing_unit_root;
            });
        }
    }

    /* NON-SIMPLE TRANSITIONS & ANIMATIONS */

    .nav-items
    {
        // Best to have a default due to bottom value being set in JavaScript.
        .transition(bottom 300ms @ease_in_sine);

        // overflow-y: auto;
    }

    // Menu opening:

    &.collapsed-remove
    {
        .transition-duration(300ms);

        .nav-items
        {
            // This also works in case of JavaScript setting bottom value.
            // .transition(bottom 400ms @ease_in_sine);

            //overflow-y: hidden;

            ul.nav-primary li.gallery a,
            ul.nav-primary li.list a,
            ul.nav-sub li a
            {
                .transition(none);

                opacity: 0;
            }
        }
    }

    &.collapsed-remove-active
    {
        .nav-items
        {
            ul.nav-primary li.gallery a,
            ul.nav-primary li.list a,
            ul.nav-sub li a
            {
                .transition(opacity 100ms @ease_in_sine 200ms);

                opacity: 1;
            }
        }

    }

    // Menu closing:

    &.collapsed-hard
    {
        .nav-items
        {
            .transition(none);
        }
    }

    &.collapsed-add
    {
        .transition-duration(200ms);

        .nav-items
        {
            ul.nav-primary li.gallery a,
            ul.nav-primary li.list a,
            ul.nav-sub li a
            {
                .transition(none);

                opacity: 1;
            }
        }
    }

    &.collapsed
    {
        .nav-items
        {
            // Final bottom state should go here, but since I needed to fall
            // back to JavaScript to get the bottom position right, it's
            // missing.

            //overflow-y: hidden;

            ul.nav-primary li.gallery a,
            ul.nav-primary li.list a,
            ul.nav-sub li a
            {
                .transition(opacity 100ms @ease_in_sine);

                opacity: 0;
            }
        }
    }

    &.compact-add
    {
        .transition-duration(@time_compact_animation);

        .nav-icon-wrapper
        {
            a#nav-icon
            {
                .transition(none);

                opacity: 0;
            }
        }
    }

    &.compact
    {
        .nav-icon-wrapper
        {
            a#nav-icon
            {
                .transition(opacity 100ms @ease_in_sine 200ms);

                opacity: 1;
            }
        }

        .nav-items
        {
            .transition(bottom 200ms @ease_in_sine);

            .respond-until-including(@multi_column_bp,
            {
                // Default for compacted state.
                bottom: 0;
            });
        }
    }

    &.compact-remove
    {
        .nav-items
        {
            .transition(none);
        }
    }
};

.primary-nav-arrow()
{
    nav#nav-main
    {
        .nav-items
        {
            ul.nav-primary
            {
                &::before
                {
                    .rotate(45deg);
                    .transition(all 200ms ease-out);

                    @box_length: ceil( @spacing_unit_root / 6 );

                    background: #1f1f1f;
                    content: '';
                    height: @box_length;
                    position: absolute;
                        top: -1 * (@spacing_unit_root / 2 + @box_length / 2);
                        right: @spacing_unit_root / 2 + 2.375em / 2 - @box_length / 2;
                        //z-index: -1;
                    width: @box_length;
                }

                &.animating::before
                {
                    top: 0;
                }
            }
        }
    }

    nav#nav-main.centered
    {
        .nav-items
        {
            ul.nav-primary
            {
                &::before
                {
                    @box_length: @spacing_unit_root / 4;

                    margin-right: -1 * @box_length / 2;
                    right: 50%;
                }
            }
        }
    }
}
